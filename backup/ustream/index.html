<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>UStream.tv Widget</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="../css/normalize.min.css">
        <link rel="stylesheet" href="../css/main.css">
        <script src="../js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
    </head>
    <body>
        <div class="ustream-widget" id="ustream-widget"></div>
        <script src="../js/vendor/jquery-1.9.0.min.js"></script>
        <script>
        (function() {
            var user_name, api_key, query_string;

            api_key = "EE028473488E26E1424E67B209A3C423";

            query_string = function () {
                var query_string = {};
                var query = window.location.search.substring(1);
                var vars = query.split("&");

                for ( var i = 0; i < vars.length; i++ ) {
                    var pair = vars[i].split("=");
                    if ( typeof query_string[pair[0]] === "undefined" ) {
                        query_string[pair[0]] = pair[1];
                    } else if ( typeof query_string[pair[0]] === "string" ) {
                        var arr = [ query_string[pair[0]], pair[1] ];
                        query_string[pair[0]] = arr;
                    } else {
                        query_string[pair[0]].push(pair[1]);
                    }
                }

                return query_string;
            }();

            user_name = query_string.username;

            if (typeof(user_name) === 'undefined' || user_name === "") {
                $("#ustream-widget").html("<ul><li>Please add a username</li></ul>");
            } else {
                $.getJSON('http://api.ustream.tv/json/channel/live/search/username:eq:' + user_name + '?key=' + api_key + '&callback=?', function(data) {

                    if (data != null) {
                        $("#ustream-widget").html("<ul><li><a href='http://ustream.tv/" + user_name + "' class='user-name'><img src='" + data[0].imageUrl.small + "' width='64' height='64' alt='" + user_name + " channel logo' class='icon'>" + user_name + "</a></li><li><b>LIVE</b> <span class='online'></span> " + data[0].title + "</li><li><span class='viewers'><img src='../img/eye.png' width='16' height='16' alt='' class='icon-eye' /> " + data[0].viewersNow + "</span></li></ul>");
                    } else {
                        $.getJSON('http://api.ustream.tv/json/user/' + user_name + '/getInfo?key=' + api_key + '&callback=?', function(data) {
                            if (data != null) {
                                $("#ustream-widget").html("<ul><li><a href='http://ustream.tv/" + user_name + "' class='user-name'><img src='" + data.imageUrl.small + "' width='64' height='64' alt='" + user_name + " channel logo' class='icon'>" + user_name + "</a></li><li><b>Offline</b></li></ul>");
                            } else {
                                $("#ustream-widget").html("<ul><li><a href='http://ustream.tv/" + user_name + "' class='user-name'><img src='../img/ustream-no-image.png' width='64' height='64' alt='' class='icon'>" + user_name + "</a></li><li><b>Offline</b></li></ul>");
                            }
                        });
                    }
                });
            }

        })();
        </script>
        <script>
            /*var _gaq=[['_setAccount','UA-37973757-1'],['_trackPageview']];
            (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
            g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
            s.parentNode.insertBefore(g,s)}(document,'script'));*/
        </script>
    </body>
</html>
